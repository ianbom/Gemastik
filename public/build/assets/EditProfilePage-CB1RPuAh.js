import{r as m,j as e,S as ae,J as ee}from"./app-DqvPgPLX.js";import{B as F,I as c}from"./input-_-d2rHVp.js";import{C as u,b as h,c as j,a as f}from"./card-f358nuNf.js";import{L as l}from"./label-BD41T5Mp.js";import{S as A,a as z,b as M,c as K,d as E}from"./select-QaOMUZcd.js";import{T as se}from"./textarea-CC7NFrUF.js";import{A as pe}from"./arrow-left-eTNxQMZi.js";import{I as xe,d as ue,X as he,C as je}from"./CitizenLayout-CZTR47zY.js";import{M as fe}from"./map-pin-BcgFq_I_.js";import{C as ge}from"./camera-6p7ssyJZ.js";import{U as ye,F as Ne}from"./upload-BILbDJFA.js";import{L as ve,E as L}from"./lock-BCR5bhGG.js";import{E as I}from"./eye-BmKQ7d-8.js";import"./index-28FC01iy.js";import"./index-DCNyB5w5.js";import"./createLucideIcon-9_-YZXNr.js";import"./Combination-bzKAMG6s.js";const be=({provinces:g,onBack:p,auth:d})=>{var B,D,U,V,$,T,J,R,G,O,H,W,X,Q,Y,Z;const[i,N]=m.useState(!1),[v,re]=m.useState(!1),[b,ie]=m.useState(!1),[w,te]=m.useState(!1),[a,x]=m.useState({name:((B=d.user)==null?void 0:B.name)||"",phone:((D=d.user)==null?void 0:D.phone)||"",address:((U=d.user)==null?void 0:U.address)||"",province_id:(($=(V=d.user)==null?void 0:V.province_id)==null?void 0:$.toString())||"",city_id:((J=(T=d.user)==null?void 0:T.city_id)==null?void 0:J.toString())||"",district_id:((G=(R=d.user)==null?void 0:R.district_id)==null?void 0:G.toString())||"",current_password:"",password:"",password_confirmation:"",community:{name:((H=(O=d.user)==null?void 0:O.community)==null?void 0:H.name)||"",member_count:((Q=(X=(W=d.user)==null?void 0:W.community)==null?void 0:X.member_count)==null?void 0:Q.toString())||"",description:((Z=(Y=d.user)==null?void 0:Y.community)==null?void 0:Z.description)||""}}),[y,_]=m.useState([]),k=g.find(s=>s.id.toString()===a.province_id),C=(k==null?void 0:k.cities)??[],S=C.find(s=>s.id.toString()===a.city_id),q=(S==null?void 0:S.districts)??[],n=(s,r)=>{if(s.startsWith("community.")){const t=s.split(".")[1];x(o=>({...o,community:{...o.community,[t]:r}}))}else x(s==="province_id"?t=>({...t,province_id:r,city_id:"",district_id:""}):s==="city_id"?t=>({...t,city_id:r,district_id:""}):t=>({...t,[s]:r}))},ne=s=>{if(s){const r=Array.from(s).filter(t=>t.size>10485760?(alert(`File ${t.name} terlalu besar. Maksimal 10MB.`),!1):!0);_(r)}},le=s=>{_(r=>r.filter((t,o)=>o!==s))},de=()=>{const s=[{field:"name",name:"Nama Lengkap"},{field:"phone",name:"Nomor Telepon"},{field:"address",name:"Alamat"},{field:"province_id",name:"Provinsi"},{field:"city_id",name:"Kota/Kabupaten"},{field:"district_id",name:"Kecamatan"}];for(const{field:r,name:t}of s)if(!a[r])return alert(`${t} wajib diisi.`),!1;return!0},ce=async s=>{if(s.preventDefault(),!de())return;N(!0);const r=new FormData;r.append("name",a.name),r.append("phone",a.phone),r.append("address",a.address),r.append("province_id",a.province_id),r.append("city_id",a.city_id),r.append("district_id",a.district_id),a.community&&(r.append("community[name]",a.community.name),r.append("community[member_count]",a.community.member_count),r.append("community[description]",a.community.description)),y.length>0&&r.append("profile_url",y[0]),a.password&&(r.append("current_password",a.current_password),r.append("password",a.password),r.append("password_confirmation",a.password_confirmation)),console.log("FormData entries:");for(const t of r.entries())console.log(`${t[0]}:`,t[1]);ae.post("/community/update-profile",r,{forceFormData:!0,onStart:()=>N(!0),onSuccess:()=>{x({name:"",phone:"",address:"",province_id:"",city_id:"",district_id:"",current_password:"",password:"",password_confirmation:"",community:{name:"",member_count:"",description:""}}),_([])},onError:t=>{console.error("Validation errors:",t);const o=Object.entries(t).map(([oe,P])=>{const me=Array.isArray(P)?P:[P];return`${oe}: ${me.join(", ")}`}).join(`
`);alert(`Validation errors:
${o}`)},onFinish:()=>N(!1)})};return e.jsxs("div",{className:"px-4 py-8 mx-auto space-y-6 max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs(F,{variant:"ghost",onClick:p,className:"text-gray-600 hover:text-sky-600",disabled:i,children:[e.jsx(pe,{size:20,className:"mr-2"}),"Kembali ke Profil Saya"]}),e.jsxs("div",{className:"space-x-1 text-sm text-gray-500",children:[e.jsx("span",{className:"cursor-pointer hover:underline",children:"Home"}),e.jsx("span",{className:"cursor-pointer hover:underline",children:"/ Profil"})," ","/",e.jsx("span",{className:"font-medium text-gray-700",children:"Edit Profil"})]})]}),e.jsxs("form",{onSubmit:ce,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(u,{className:"flex flex-col h-full",children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center",children:[e.jsx(xe,{size:20,className:"mr-2 text-sky-600"}),"Informasi Pengguna"]})}),e.jsxs(f,{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"name",children:["Nama Lengkap"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"name",placeholder:"Masukkan nama lengkap Anda",value:a.name,onChange:s=>n("name",s.target.value),required:!0,disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"phone",children:["Nomor Telepon"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"phone",placeholder:"Masukkan nomor telepon Anda",value:a.phone,type:"phone",onChange:s=>n("phone",s.target.value),required:!0,disabled:i})]})]})]})}),e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(u,{className:"flex flex-col h-full",children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center",children:[e.jsx(fe,{size:20,className:"mr-2 text-sky-600"}),"Alamat Pengguna"]})}),e.jsx(f,{className:"flex-1 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{children:["Provinsi"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(A,{value:a.province_id,onValueChange:s=>n("province_id",s),disabled:i,children:[e.jsx(z,{children:e.jsx(M,{placeholder:"Pilih provinsi"})}),e.jsx(K,{children:g.map(s=>e.jsx(E,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{children:["Kota/Kabupaten"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(A,{value:a.city_id,onValueChange:s=>n("city_id",s),disabled:!C.length||i,children:[e.jsx(z,{children:e.jsx(M,{placeholder:"Pilih kota"})}),e.jsx(K,{children:C.map(s=>e.jsx(E,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{children:["Kecamatan"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(A,{value:a.district_id,onValueChange:s=>n("district_id",s),disabled:!q.length||i,children:[e.jsx(z,{children:e.jsx(M,{placeholder:"Pilih kecamatan"})}),e.jsx(K,{children:q.map(s=>e.jsx(E,{value:s.id.toString(),children:s.name},s.id))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"address",children:["Alamat Lengkap"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(se,{id:"address",placeholder:"Masukkan detail alamat Anda",rows:3,value:a.address,onChange:s=>n("address",s.target.value),required:!0,disabled:i})]})]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(u,{className:"flex flex-col h-full",children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center",children:[e.jsx(ue,{size:20,className:"mr-2 text-sky-600"}),"Informasi Komunitas"]})}),e.jsxs(f,{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"community_name",children:["Nama Komunitas"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"community_name",placeholder:"Masukkan nama komunitas Anda",value:a.community.name,onChange:s=>n("community.name",s.target.value),required:!0,disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"member_count",children:["Jumlah Anggota",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"member_count",placeholder:"Masukkan jumlah anggota Anda",value:a.community.member_count,onChange:s=>n("community.member_count",s.target.value),type:"number",required:!0,disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"description",children:["Deskripsi Komunitas"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(se,{id:"description",placeholder:"Masukkan deskripsi komunitas Anda",rows:3,value:a.community.description,onChange:s=>n("community.description",s.target.value),required:!0,disabled:i})]})]})]})}),e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(u,{className:"flex flex-col h-full",children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center",children:[e.jsx(ge,{size:20,className:"mr-2 text-sky-600"}),"Foto Profil Pengguna"]})}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"p-8 text-center transition-colors border-2 border-gray-300 border-dashed rounded-lg hover:border-sky-400",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",onChange:s=>ne(s.target.files),className:"hidden",id:"file-upload",disabled:i}),e.jsxs("label",{htmlFor:"file-upload",className:`cursor-pointer ${i?"cursor-not-allowed opacity-50":""}`,children:[e.jsx(ye,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"mb-2 text-lg font-medium text-gray-700",children:"Klik untuk mengunggah atau seret file ke sini"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, JPEG hingga 2MB"})]})]}),y.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:y.map((s,r)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg aspect-square",children:s.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(s),alt:s.name,className:"object-cover w-full h-full rounded-lg"}):e.jsx(Ne,{size:24,className:"text-gray-400"})}),e.jsx("button",{type:"button",onClick:()=>le(r),className:"absolute flex items-center justify-center w-6 h-6 text-white transition-opacity bg-red-500 rounded-full opacity-0 -right-2 -top-2 group-hover:opacity-100",disabled:i,children:e.jsx(he,{size:14})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 truncate",children:s.name})]},r))})]})]})})]}),e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(u,{className:"flex flex-col h-full",children:[e.jsxs(h,{children:[e.jsxs(j,{className:"flex items-center",children:[e.jsx(ve,{size:20,className:"mr-2 text-sky-600"}),"Kata Sandi"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Kosongkan jika tidak ingin mengubah password"})]}),e.jsxs(f,{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"current_password",children:["Password Saat Ini"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{id:"current_password",type:w?"text":"password",placeholder:"Masukkan password lama Anda",value:a.current_password,onChange:s=>n("current_password",s.target.value),disabled:i,className:"pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 flex items-center text-gray-500 right-2",onClick:()=>te(!w),children:w?e.jsx(L,{size:18}):e.jsx(I,{size:18})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"password",children:["Password Baru",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{id:"password",type:v?"text":"password",placeholder:"Masukkan password baru Anda",value:a.password,onChange:s=>n("password",s.target.value),disabled:i,className:"pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 flex items-center text-gray-500 right-2",onClick:()=>re(!v),children:v?e.jsx(L,{size:18}):e.jsx(I,{size:18})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"password_confirmation",children:["Konfirmasi Password Baru",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{id:"password_confirmation",placeholder:"Masukkan ulang password baru",type:b?"text":"password",value:a.password_confirmation,onChange:s=>n("password_confirmation",s.target.value),disabled:i,className:"pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 flex items-center text-gray-500 right-2",onClick:()=>ie(!b),children:b?e.jsx(L,{size:18}):e.jsx(I,{size:18})})]})]})]})]})}),e.jsxs("div",{className:"flex flex-col justify-start gap-4 p-3 bg-white border border-gray-200 rounded-lg shadow-sm sm:flex-row",children:[e.jsx(F,{type:"button",variant:"outline",onClick:p,className:"sm:w-auto",disabled:i,children:"Batal"}),e.jsx(F,{type:"submit",className:"bg-sky-600 hover:bg-sky-700 sm:w-auto",size:"lg",disabled:i,children:i?"Mengirim...":"Update"})]})]})]})},Ue=()=>{var i;const{props:g}=ee(),p=(i=ee().props.auth)==null?void 0:i.user,d=g.provinces??[];return p?e.jsx(je,{currentPage:"community/edit-profile",children:e.jsx(be,{auth:{user:p},provinces:d,onBack:()=>ae.visit("/community/profile")})}):null};export{Ue as default};
