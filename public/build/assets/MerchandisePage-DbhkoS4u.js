import{r as x,j as e,S as H,J as E}from"./app-D1PQqydB.js";import{S as _,a as T,b as P,c as K,u as M,B as R,C as O}from"./CitizenLayout-D6PfXXw3.js";import{B as k,I as V}from"./input-BOaatTCr.js";import{C,b as $,c as J,a as A}from"./card-DS9sCv-E.js";import{S as I,a as B,b as F,c as L,d as m}from"./select-Bh72tW7-.js";import{a as G}from"./formatDate-DdkzSpcV.js";import{D as Q,a as Z,b as U,c as W,d as X,e as Y,G as q}from"./dialog-BrukTp7d.js";import{T as ee}from"./textarea-EwAyr6Kf.js";import{M as se}from"./map-pin-D80-uoOx.js";import{R as z}from"./refresh-ccw-DVaoXrPH.js";import{S as ae}from"./sliders-horizontal-CIx4Y1C6.js";import{S as te}from"./search-DduYLnXE.js";import{C as re}from"./calendar-B_2puXlR.js";import"./index-Clxr7tAl.js";import"./Combination-Dr_exLUy.js";import"./createLucideIcon--13BBMxb.js";import"./index-DwRUccRl.js";import"./index-ur6M6Mn0.js";const le=({isOpen:u,onClose:c,merchandise:a,userPoints:h,onSuccess:d})=>{const[o,r]=x.useState(""),[g,N]=x.useState(!1),[v,i]=x.useState(""),y=a?h-a.points_cost:h,p=a?h>=a.points_cost:!1,w=()=>{g||(r(""),N(!1),i(""),c())},S=async()=>{if(!(!a||!o.trim()||!p)){N(!0),i("");try{const j={merchandise_id:a.id,points_spent:a.points_cost,shipping_address:o.trim()};await new Promise((f,s)=>{H.post("merchandise",j,{onSuccess:n=>{typeof M<"u"&&M.success("Redeem berhasil! Merchandise akan segera diproses."),d&&d(),f(n),w()},onError:n=>{console.error("Redeem failed:",n),typeof n=="string"?i(n):n.err?i(n.err):n.message?i(n.message):i("Terjadi kesalahan saat melakukan redeem. Silakan coba lagi."),s(n)},onFinish:()=>{N(!1)}})})}catch(j){console.error("Exchange failed:",j),i("Terjadi kesalahan saat melakukan redeem. Silakan coba lagi."),N(!1)}}},D=o.trim().length>=10;return e.jsx(Q,{open:u,onOpenChange:w,children:e.jsxs(Z,{className:"max-w-md",children:[e.jsxs(U,{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-emerald-600"}),"Tukar Merchandise"]}),e.jsx(X,{children:"Masukkan alamat pengiriman untuk melakukan penukaran merchandise"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[v&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(T,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-red-600"}),e.jsx("p",{className:"text-sm text-red-700",children:v})]})}),e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:`/storage/${a.image_url}`,alt:a.name,className:"h-20 w-20 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:a.name}),e.jsx("p",{className:"line-clamp-2 text-sm text-gray-600",children:a.description}),e.jsxs("div",{className:"mt-2 flex items-center text-emerald-600",children:[e.jsx(P,{size:14,className:"mr-1 fill-current"}),e.jsxs("span",{className:"font-semibold",children:[a.points_cost.toLocaleString("id-ID")," ","Poin"]})]})]})]})}),e.jsxs("div",{className:"rounded-lg bg-gray-50 p-4",children:[e.jsx("h5",{className:"mb-3 font-medium text-gray-900",children:"Informasi Poin"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Poin Saat Ini:"}),e.jsxs("span",{className:"font-semibold text-emerald-600",children:[h.toLocaleString("id-ID")," ","Poin"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Biaya Penukaran:"}),e.jsxs("span",{className:"font-semibold text-red-600",children:["-",a.points_cost.toLocaleString("id-ID")," ","Poin"]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Sisa Poin:"}),e.jsxs("span",{className:`font-semibold ${y>=0?"text-emerald-600":"text-red-600"}`,children:[y.toLocaleString("id-ID")," ","Poin"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700",children:[e.jsx(se,{className:"mr-1 h-4 w-4"}),"Alamat Pengiriman *"]}),e.jsx(ee,{placeholder:"Contoh: Jl. Merdeka No. 123, RT 01/RW 02, Kelurahan ABC, Kecamatan XYZ, Kota DEF, Jawa Timur 12345",value:o,onChange:j=>{r(j.target.value),i("")},rows:4,className:"resize-none",disabled:g}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Pastikan alamat yang Anda masukkan sudah benar dan lengkap"}),e.jsxs("p",{className:`text-xs ${o.length>=10?"text-green-600":"text-gray-400"}`,children:[o.length,"/10 minimum"]})]})]}),!p&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(T,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-red-600"}),e.jsxs("p",{className:"text-sm text-red-700",children:["Poin Anda tidak mencukupi untuk melakukan penukaran ini. Anda membutuhkan"," ",(a.points_cost-h).toLocaleString("id-ID")," ","poin lagi."]})]})}),p&&D&&e.jsx("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(K,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-green-600"}),e.jsx("p",{className:"text-sm text-green-700",children:"Siap untuk ditukar! Pastikan alamat sudah benar sebelum melanjutkan."})]})})]}),e.jsxs(Y,{className:"gap-2",children:[e.jsx(k,{variant:"outline",onClick:w,disabled:g,children:"Batal"}),e.jsx(k,{onClick:S,disabled:!D||!p||g,className:"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400",children:g?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),"Memproses..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Konfirmasi Tukar"]})})]})]})})},ne=({merchandise:u,userPoints:c})=>{const[a,h]=x.useState("newest"),[d,o]=x.useState(""),[r,g]=x.useState({status:"semua",priceRange:"semua",startDate:"",endDate:""}),[N,v]=x.useState(!1),[i,y]=x.useState(null),p=x.useMemo(()=>{let s=u;return d.trim()&&(s=s.filter(t=>{var l,b;return((l=t.name)==null?void 0:l.toLowerCase().includes(d.toLowerCase()))||((b=t.description)==null?void 0:b.toLowerCase().includes(d.toLowerCase()))})),r.status!=="semua"&&(s=s.filter(t=>r.status==="active"?t.is_active:r.status==="inactive"?!t.is_active:!0)),r.priceRange!=="semua"&&(s=s.filter(t=>{const l=t.points_cost;switch(r.priceRange){case"low":return l<=100;case"medium":return l>100&&l<=500;case"high":return l>500;default:return!0}})),r.startDate&&(s=s.filter(t=>{const l=new Date(t.created_at),b=new Date(r.startDate);return l>=b})),r.endDate&&(s=s.filter(t=>{const l=new Date(t.created_at),b=new Date(r.endDate);return l<=b})),[...s].sort((t,l)=>{switch(a){case"newest":return new Date(l.created_at).getTime()-new Date(t.created_at).getTime();case"oldest":return new Date(t.created_at).getTime()-new Date(l.created_at).getTime();case"name":return(t.name||"").localeCompare(l.name||"");case"price-low":return t.points_cost-l.points_cost;case"price-high":return l.points_cost-t.points_cost;default:return 0}})},[u,d,r,a]),w=(s,n)=>{g(t=>({...t,[s]:n}))},S=()=>{g({status:"semua",priceRange:"semua",startDate:"",endDate:""}),o(""),h("newest")},D=s=>{y(s),v(!0)},j=()=>{v(!1),y(null)},f=d.trim()||r.status!=="semua"||r.priceRange!=="semua"||r.startDate||r.endDate;return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-start justify-between md:flex-row md:items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"mb-2 text-3xl font-bold text-gray-900",children:"Toko Merchandise"}),e.jsx("p",{className:"text-gray-600",children:"Tukarkan poin Anda dengan merchandise eksklusif dan jadilah bagian dari gerakan lingkungan"})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsxs("div",{className:"flex items-center rounded-lg bg-yellow-100 px-4 py-2",children:[e.jsx(P,{className:"mr-2 h-5 w-5 text-yellow-800"}),e.jsxs("span",{className:"font-semibold text-yellow-800",children:["Poin Saya: ",c.toLocaleString("id-ID")," Poin"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-4",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(C,{className:"sticky top-24",children:[e.jsx($,{children:e.jsxs(J,{className:"flex items-center justify-between text-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{size:20,className:"mr-2 text-emerald-600"}),"Filter Merchandise"]}),f&&e.jsx("span",{className:"rounded-full bg-emerald-100 px-2 py-1 text-xs text-emerald-600",children:"Aktif"})]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Rentang Harga (Poin)"}),e.jsxs(I,{value:r.priceRange,onValueChange:s=>w("priceRange",s),children:[e.jsx(B,{children:e.jsx(F,{placeholder:"Pilih rentang harga"})}),e.jsxs(L,{children:[e.jsx(m,{value:"semua",children:"Semua Harga"}),e.jsx(m,{value:"low",children:"â‰¤ 100 Poin"}),e.jsx(m,{value:"medium",children:"101 - 500 Poin"}),e.jsx(m,{value:"high",children:"+ 500 Poin"})]})]})]}),e.jsx("div",{className:"space-y-2 pt-4",children:e.jsxs(k,{variant:"outline",className:"flex w-full items-center justify-center gap-2",onClick:S,disabled:!f,children:[e.jsx(z,{className:"h-4 w-4"}),"Reset Filter"]})})]})]})}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("div",{className:"mb-6 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs(I,{value:a,onValueChange:h,children:[e.jsx(B,{className:"w-48",children:e.jsx(F,{placeholder:"Urutkan berdasarkan"})}),e.jsxs(L,{children:[e.jsx(m,{value:"newest",children:"Terbaru"}),e.jsx(m,{value:"oldest",children:"Terlama"}),e.jsx(m,{value:"name",children:"Nama A-Z"}),e.jsx(m,{value:"price-low",children:"Harga Terendah"}),e.jsx(m,{value:"price-high",children:"Harga Tertinggi"})]})]})}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(te,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(V,{placeholder:"Cari merchandise...",className:"pl-10",value:d,onChange:s=>o(s.target.value)})]})]}),p.length>0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3",children:p.map(s=>e.jsxs(C,{className:"group cursor-pointer border-0 shadow-md transition-all duration-300 hover:-translate-y-1 hover:shadow-lg",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:`/storage/${s.image_url}`,alt:s.name,className:"h-48 w-full object-contain transition-transform duration-300 group-hover:scale-105"}),e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(R,{className:s.is_active?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200",children:s.is_active?"Tersedia":"Habis"})}),c<s.points_cost&&e.jsx("div",{className:"absolute left-3 top-3",children:e.jsx(R,{className:"bg-yellow-100 text-yellow-800",children:"Poin Kurang"})})]}),e.jsxs(A,{className:"p-4",children:[e.jsx("h3",{className:"mb-2 line-clamp-2 font-semibold text-gray-900 transition-colors group-hover:text-emerald-600",children:s.name}),e.jsx("p",{className:"mb-3 line-clamp-2 text-sm text-gray-600",children:s.description}),e.jsx("div",{className:"mb-3 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center text-lg font-bold text-emerald-600",children:[e.jsx(P,{size:16,className:"mr-1 fill-current"}),s.points_cost.toLocaleString("id-ID")," ","Poin"]})}),e.jsxs("div",{className:"mb-4 flex items-center text-sm text-gray-500",children:[e.jsx(re,{size:14,className:"mr-1"}),e.jsxs("span",{children:["Ditambahkan:"," ",G(s.created_at)]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{className:"flex-1 bg-amber-600 transition-colors duration-200 hover:bg-amber-700 disabled:bg-gray-400",onClick:n=>{n.stopPropagation(),D(s)},disabled:!s.is_active||c<s.points_cost,children:[e.jsx(_,{size:16,className:"mr-2"}),s.is_active?c<s.points_cost?"Poin Kurang":"Tukar":"Habis"]})})]})]},s.id))})}):e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsxs(C,{className:"w-full px-8 py-32 text-center",children:[e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx("div",{className:"rounded-full bg-gray-100 p-4",children:e.jsx(q,{size:32,className:"h-12 w-12 text-gray-400"})})}),e.jsx("h3",{className:"mb-2 text-lg font-semibold text-gray-900",children:f?"Tidak Ada Merchandise yang Sesuai":"Merchandise Belum Tersedia"}),e.jsx("p",{className:"text-sm text-gray-500",children:f?"Coba ubah filter atau kata kunci pencarian Anda.":"Belum ada merchandise yang tersedia saat ini. Coba lagi nanti."}),f&&e.jsx(k,{variant:"outline",className:"mt-4",onClick:S,children:"Reset Filter"})]})})]})]}),e.jsx(le,{isOpen:N,onClose:j,merchandise:i,userPoints:c})]})},Se=()=>{const{props:u}=E(),c=u.merchandise||[],a=Number(u.userPoints??0);return console.log("point",a),e.jsx(O,{currentPage:"merchandise",children:e.jsx(ne,{merchandise:c,userPoints:a})})};export{Se as default};
