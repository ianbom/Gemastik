import{r as g,j as e,J as z}from"./app-DqvPgPLX.js";import{B as h,C as M}from"./CitizenLayout-CZTR47zY.js";import{B as b,I as F}from"./input-_-d2rHVp.js";import{C as R,a as T}from"./card-f358nuNf.js";import{S as y,a as N,b as w,c as k,d as o}from"./select-QaOMUZcd.js";import{f as E}from"./formatDate-UvSedfNW.js";import{g as B}from"./categoryReportLabel-Bo3G_xyd.js";import{g as D,a as I}from"./reportStatusLabel-CeJ63OXr.js";import{c as V,l as _,a as A,M as W,T as K,b as U,L}from"./TileLayer-D04JuLI4.js";import{S as $,R as H}from"./sliders-horizontal-CY56mF2c.js";import{S as O}from"./search-BSytNz48.js";import{M as Q}from"./map-pin-BcgFq_I_.js";import{C as G}from"./calendar-CqPN-hqJ.js";import{E as J}from"./eye-BmKQ7d-8.js";import"./index-28FC01iy.js";import"./Combination-bzKAMG6s.js";import"./createLucideIcon-9_-YZXNr.js";import"./index-DCNyB5w5.js";const Z=V(function(d,l){const c=new _.Popup(d,l.overlayContainer);return A(c,l)},function(d,l,{position:c},u){g.useEffect(function(){const{instance:n}=d;function f(s){s.popup===n&&(n.update(),u(!0))}function v(s){s.popup===n&&u(!1)}return l.map.on({popupopen:f,popupclose:v}),l.overlayContainer==null?(c!=null&&n.setLatLng(c),n.openOn(l.map)):l.overlayContainer.bindPopup(n),function(){var j;l.map.off({popupopen:f,popupclose:v}),(j=l.overlayContainer)==null||j.unbindPopup(),l.map.removeLayer(n)}},[d,l,u,c])});delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png"});const q=({reports:m,provinces:d,onViewReport:l})=>{const[c,u]=g.useState(!1),[i,n]=g.useState(""),[f,v]=g.useState(m),[s,j]=g.useState({category:"semua",status:"semua",province:"semua",startDate:"",endDate:""}),x=(a,t)=>{j(r=>({...r,[a]:t}))},S=()=>{j({category:"semua",status:"semua",province:"semua",startDate:"",endDate:""}),n("")};g.useEffect(()=>{let a=[...m];i.trim()&&(a=a.filter(t=>{var r,p;return t.title.toLowerCase().includes(i.toLowerCase())||((r=t.description)==null?void 0:r.toLowerCase().includes(i.toLowerCase()))||((p=t.address)==null?void 0:p.toLowerCase().includes(i.toLowerCase()))})),s.category!=="semua"&&(a=a.filter(t=>t.category.toLowerCase()===s.category.toLowerCase())),s.status!=="semua"&&(a=a.filter(t=>t.status.toLowerCase()===s.status.toLowerCase())),s.province!=="semua"&&(a=a.filter(t=>{var r;return(r=t.province)==null?void 0:r.name.toLowerCase().includes(s.province.toLowerCase())})),s.startDate&&(a=a.filter(t=>{const r=new Date(t.created_at),p=new Date(s.startDate);return r>=p})),s.endDate&&(a=a.filter(t=>{const r=new Date(t.created_at),p=new Date(s.endDate);return p.setHours(23,59,59,999),r<=p})),v(a)},[m,i,s]);const P=[{label:"Sampah Plastik",value:"sampah-plastik"},{label:"Pencemaran Air",value:"pencemaran-air"},{label:"Pencemaran Udara",value:"pencemaran-udara"},{label:"Pencemaran Tanah",value:"pencemaran-tanah"},{label:"Limbah Industri",value:"limbah-industri"},{label:"Emisi Gas Rumah Kaca",value:"emisi-gas-rumah-kaca"},{label:"Penggundulan / Kebakaran Hutan",value:"penggundulan-kebakaran-hutan"},{label:"Naiknya Permukaan Air Laut",value:"naiknya-permukaan-air-laut"},{label:"Limbah Pertanian / Peternakan",value:"limbah-pertanian-peternakan"},{label:"Lainnya",value:"lainnya"}],C=i.trim()||s.category!=="semua"||s.status!=="semua"||s.province!=="semua"||s.startDate||s.endDate;return e.jsxs("div",{className:"flex flex-col h-screen lg:flex-row",children:[e.jsx("div",{className:`bg-white shadow-lg transition-all duration-300 ${c?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"} overflow-hidden lg:relative lg:max-h-full lg:w-80 lg:border-r lg:border-gray-200 lg:opacity-100`,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"flex items-center text-xl font-semibold text-gray-900",children:[e.jsx($,{size:20,className:"mr-2 text-sky-600"}),"Filter Peta Laporan",C&&e.jsx("span",{className:"inline-block px-2 py-1 ml-2 text-xs rounded-full bg-emerald-100 text-emerald-600",children:"Aktif"})]}),e.jsx(b,{variant:"ghost",size:"sm",className:"lg:hidden",onClick:()=>u(!1),children:"×"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute w-4 h-4 text-gray-400 left-3 top-3"}),e.jsx(F,{placeholder:"Cari laporan...",className:"pl-10",value:i,onChange:a=>n(a.target.value)})]})}),(s.category!=="semua"||s.status!=="semua"||s.province!=="semua"||s.startDate||s.endDate||i)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("span",{className:"mb-1 text-xs font-medium text-gray-700",children:"Filter aktif:"}),i&&e.jsxs(h,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:['"',i,'"',e.jsx("button",{onClick:()=>n(""),className:"ml-1 text-xs",children:"×"})]}),s.category!=="semua"&&e.jsxs(h,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[s.category,e.jsx("button",{onClick:()=>x("category","semua"),className:"ml-1 text-xs",children:"×"})]}),s.status!=="semua"&&e.jsxs(h,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[D(s.status),e.jsx("button",{onClick:()=>x("status","semua"),className:"ml-1 text-xs",children:"×"})]}),s.province!=="semua"&&e.jsxs(h,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[s.province,e.jsx("button",{onClick:()=>x("province","semua"),className:"ml-1 text-xs",children:"×"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Kategori Laporan"}),e.jsxs(y,{value:s.category,onValueChange:a=>x("category",a),children:[e.jsx(N,{children:e.jsx(w,{placeholder:"Semua kategori"})}),e.jsxs(k,{children:[e.jsx(o,{value:"semua",children:"Semua Kategori"}),P.map(a=>e.jsx(o,{value:a.value,children:a.label},a.value))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Status Laporan"}),e.jsxs(y,{value:s.status,onValueChange:a=>x("status",a),children:[e.jsx(N,{children:e.jsx(w,{placeholder:"Semua status"})}),e.jsxs(k,{children:[e.jsx(o,{value:"semua",children:"Semua Status"}),e.jsx(o,{value:"pending",children:"Menunggu"}),e.jsx(o,{value:"verified",children:"Terverifikasi"}),e.jsx(o,{value:"on-progress",children:"Sedang Diproses"}),e.jsx(o,{value:"rejected",children:"Ditolak"}),e.jsx(o,{value:"completed",children:"Selesai"}),e.jsx(o,{value:"under-authority",children:"Ditangani Pihak Berwenang"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Provinsi"}),e.jsxs(y,{value:s.province,onValueChange:a=>x("province",a),children:[e.jsx(N,{children:e.jsx(w,{placeholder:"Semua Provinsi"})}),e.jsxs(k,{children:[e.jsx(o,{value:"semua",children:"Semua Provinsi"}),d.map(a=>e.jsx(o,{value:a.name,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tanggal Mulai"}),e.jsx("input",{type:"date",className:"w-full px-2 py-2 border border-gray-200 rounded-md",value:s.startDate,onChange:a=>x("startDate",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tanggal Selesai"}),e.jsx("input",{type:"date",className:"w-full px-2 py-2 border border-gray-200 rounded-md",value:s.endDate,onChange:a=>x("endDate",a.target.value),min:s.startDate})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(b,{variant:"outline",className:"flex items-center justify-center w-full gap-2",onClick:S,disabled:!C,children:[e.jsx(H,{className:"w-4 h-4"}),"Reset Filter"]})})]})]})}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"p-4 lg:hidden",children:e.jsx(b,{onClick:()=>u(!c),className:"w-full text-white bg-sky-600",children:c?"Tutup Filter":"Tampilkan Filter"})}),e.jsxs(W,{center:[-2.5489,118.0149],zoom:5,scrollWheelZoom:!0,className:"z-10 w-full h-full",children:[e.jsx(K,{attribution:'© <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),f.map(a=>{var t,r;return e.jsx(U,{position:[a.latitude,a.longitude],children:e.jsx(Z,{className:"custom-popup",minWidth:280,maxWidth:320,closeButton:!0,autoPan:!0,children:e.jsxs("div",{className:"relative overflow-hidden bg-white rounded-lg shadow-lg",children:[e.jsxs("div",{className:"relative h-32 bg-gradient-to-r from-sky-500 to-blue-600",children:[(t=a.media)!=null&&t[0]?(r=a.media[0].media_type)!=null&&r.startsWith("video")?e.jsxs("div",{className:"relative w-full h-full bg-black",children:[e.jsx("video",{className:"object-cover w-full h-full opacity-50",src:`/storage/${a.media[0].media_url}`,muted:!0,preload:"metadata"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"p-2 rounded-full bg-white/80",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-black",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-5.197-3.03A1 1 0 008 9.03v5.94a1 1 0 001.555.832l5.197-3.03a1 1 0 000-1.664z"})})})})]}):e.jsx("img",{src:`/storage/${a.media[0].media_url}`,alt:a.title,className:"object-cover w-full h-full"}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gray-800",children:e.jsx("svg",{className:"w-8 h-8 text-white/80",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(h,{className:`${I(a.status)} text-xs font-medium shadow-sm`,children:D(a.status)})}),a.hasMission&&e.jsx("div",{className:"absolute left-2 top-2",children:e.jsx(h,{className:"text-xs font-medium text-white bg-blue-500 shadow-sm",children:"Ada Misi"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(h,{className:"text-xs font-medium text-gray-700 border-gray-200 bg-gray-50",children:B(a.category)})}),e.jsx("h3",{className:"mb-3 text-base font-semibold leading-tight text-gray-900 line-clamp-2",children:a.title}),e.jsxs("div",{className:"flex items-start mb-3 text-sm text-gray-600",children:[e.jsx(Q,{size:14,className:"mr-2 mt-0.5 flex-shrink-0 text-gray-400"}),e.jsx("span",{className:"line-clamp-2",children:a.address})]}),e.jsx("div",{className:"flex items-center justify-between mb-4 text-xs text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{size:12,className:"mr-1"}),e.jsx("span",{children:E(a.created_at)})]})}),e.jsxs(b,{size:"sm",onClick:()=>l(a.id),className:"w-full text-white transition-colors duration-200 bg-cyan-600 hover:bg-cyan-700",children:[e.jsx(J,{size:14,className:"mr-2"}),"Lihat Detail"]})]})]})})},a.id)})]}),e.jsx("div",{className:"absolute z-20 bottom-4 right-4",children:e.jsx(R,{className:"shadow-lg bg-white/90 backdrop-blur-sm",children:e.jsxs(T,{className:"p-3 text-center",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[f.length," Laporan Ditemukan"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Klik marker untuk lihat detail"})]})})})]})]})},ge=()=>{const{props:m}=z(),d=m.reports||[],l=m.provinces||[],c=m.cities||[],u=m.districts||[],i=n=>{window.location.href=`/report/${n}`};return e.jsx(M,{currentPage:"map",children:e.jsx(q,{reports:d,provinces:l,cities:c,districts:u,onViewReport:i})})};export{ge as default};
