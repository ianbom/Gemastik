import{r as c,j as e,S as J,J as ee}from"./app-D1PQqydB.js";import{B as C,I as p}from"./input-BOaatTCr.js";import{C as u,b as j,c as f,a as g}from"./card-DS9sCv-E.js";import{L as n}from"./label-B5mS19Xq.js";import{S as P,a as F,b as z,c as M,d as A}from"./select-Bh72tW7-.js";import{T as se}from"./textarea-EwAyr6Kf.js";import{A as ae}from"./arrow-left-CE1yri2s.js";import{I as re,X as ie,C as te}from"./CitizenLayout-D6PfXXw3.js";import{M as le}from"./map-pin-D80-uoOx.js";import{L as ne,E}from"./lock-u10jz7y1.js";import{E as K}from"./eye-V8MiIAM9.js";import{C as de}from"./camera-_MWkjkkq.js";import{U as ce,F as oe}from"./upload-BLX4w0hK.js";import"./index-Clxr7tAl.js";import"./index-DwRUccRl.js";import"./createLucideIcon--13BBMxb.js";import"./Combination-Dr_exLUy.js";const me=({provinces:o,onBack:m,auth:d})=>{var I,B,U,T,q,D,V,R,G;const[i,N]=c.useState(!1),[v,$]=c.useState(!1),[y,H]=c.useState(!1),[w,O]=c.useState(!1),[r,x]=c.useState({name:((I=d.user)==null?void 0:I.name)||"",phone:((B=d.user)==null?void 0:B.phone)||"",address:((U=d.user)==null?void 0:U.address)||"",province_id:((q=(T=d.user)==null?void 0:T.province_id)==null?void 0:q.toString())||"",city_id:((V=(D=d.user)==null?void 0:D.city_id)==null?void 0:V.toString())||"",district_id:((G=(R=d.user)==null?void 0:R.district_id)==null?void 0:G.toString())||"",current_password:"",password:"",password_confirmation:""}),[h,b]=c.useState([]),_=o.find(s=>s.id.toString()===r.province_id),S=(_==null?void 0:_.cities)??[],k=S.find(s=>s.id.toString()===r.city_id),L=(k==null?void 0:k.districts)??[],l=(s,a)=>{x(s==="province_id"?t=>({...t,province_id:a,city_id:"",district_id:""}):s==="city_id"?t=>({...t,city_id:a,district_id:""}):t=>({...t,[s]:a}))},W=s=>{if(s){const a=Array.from(s).filter(t=>t.size>10485760?(alert(`File ${t.name} terlalu besar. Maksimal 10MB.`),!1):!0);b(a)}},X=s=>{b(a=>a.filter((t,Z)=>Z!==s))},Q=()=>{const s=[{field:"name",name:"Nama Lengkap"},{field:"phone",name:"Nomor Telepon"},{field:"address",name:"Alamat"},{field:"province_id",name:"Provinsi"},{field:"city_id",name:"Kota/Kabupaten"},{field:"district_id",name:"Kecamatan"}];for(const{field:a,name:t}of s)if(!r[a])return alert(`${t} wajib diisi.`),!1;return!0},Y=async s=>{if(s.preventDefault(),!Q())return;N(!0);const a=new FormData;a.append("name",r.name),a.append("phone",r.phone),a.append("address",r.address),a.append("province_id",r.province_id),a.append("city_id",r.city_id),a.append("district_id",r.district_id),h.length>0&&a.append("profile_url",h[0]),r.password&&(a.append("current_password",r.current_password),a.append("password",r.password),a.append("password_confirmation",r.password_confirmation)),J.post("/update-profile",a,{forceFormData:!0,onStart:()=>N(!0),onFinish:()=>N(!1),onSuccess:()=>{x({name:"",phone:"",address:"",province_id:"",city_id:"",district_id:"",current_password:"",password:"",password_confirmation:""}),b([])},onError:t=>{console.error("Form errors:",t)}})};return e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6 px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs(C,{variant:"ghost",onClick:m,className:"text-gray-600 hover:text-emerald-600",disabled:i,children:[e.jsx(ae,{size:20,className:"mr-2"}),"Kembali ke Profil Saya"]}),e.jsxs("div",{className:"space-x-1 text-sm text-gray-500",children:[e.jsx("span",{className:"cursor-pointer hover:underline",children:"Home"}),e.jsx("span",{className:"cursor-pointer hover:underline",children:"/ Profil"})," ","/",e.jsx("span",{className:"font-medium text-gray-700",children:"Edit Profil"})]})]}),e.jsxs("form",{onSubmit:Y,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(u,{className:"flex h-full flex-col",children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center",children:[e.jsx(re,{size:20,className:"mr-2 text-emerald-600"}),"Informasi Pengguna"]})}),e.jsxs(g,{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"name",children:["Nama Lengkap"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{id:"name",placeholder:"Masukkan nama lengkap Anda",value:r.name,onChange:s=>l("name",s.target.value),required:!0,disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"phone",children:["Nomor Telepon"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{id:"phone",placeholder:"Masukkan nomor telepon Anda",value:r.phone,type:"phone",onChange:s=>l("phone",s.target.value),required:!0,disabled:i})]})]})]})}),e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(u,{className:"flex h-full flex-col",children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center",children:[e.jsx(le,{size:20,className:"mr-2 text-emerald-600"}),"Alamat Pengguna"]})}),e.jsx(g,{className:"flex-1 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:["Provinsi"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(P,{value:r.province_id,onValueChange:s=>l("province_id",s),disabled:i,children:[e.jsx(F,{children:e.jsx(z,{placeholder:"Pilih provinsi"})}),e.jsx(M,{children:o.map(s=>e.jsx(A,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:["Kota/Kabupaten"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(P,{value:r.city_id,onValueChange:s=>l("city_id",s),disabled:!S.length||i,children:[e.jsx(F,{children:e.jsx(z,{placeholder:"Pilih kota"})}),e.jsx(M,{children:S.map(s=>e.jsx(A,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:["Kecamatan"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(P,{value:r.district_id,onValueChange:s=>l("district_id",s),disabled:!L.length||i,children:[e.jsx(F,{children:e.jsx(z,{placeholder:"Pilih kecamatan"})}),e.jsx(M,{children:L.map(s=>e.jsx(A,{value:s.id.toString(),children:s.name},s.id))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"address",children:["Alamat Lengkap"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(se,{id:"address",placeholder:"Masukkan detail alamat Anda",rows:3,value:r.address,onChange:s=>l("address",s.target.value),required:!0,disabled:i})]})]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(u,{className:"flex h-full flex-col",children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center",children:[e.jsx(ne,{size:20,className:"mr-2 text-emerald-600"}),"Kata Sandi"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Kosongkan jika tidak ingin mengubah password"})]}),e.jsxs(g,{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"current_password",children:["Password Saat Ini"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"current_password",type:w?"text":"password",placeholder:"Masukkan password lama Anda",value:r.current_password,onChange:s=>l("current_password",s.target.value),disabled:i,className:"pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-gray-500",onClick:()=>O(!w),children:w?e.jsx(E,{size:18}):e.jsx(K,{size:18})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"password",children:["Password Baru",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"password",type:v?"text":"password",placeholder:"Masukkan password baru Anda",value:r.password,onChange:s=>l("password",s.target.value),disabled:i,className:"pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-gray-500",onClick:()=>$(!v),children:v?e.jsx(E,{size:18}):e.jsx(K,{size:18})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:"password_confirmation",children:["Konfirmasi Password Baru",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"password_confirmation",placeholder:"Masukkan ulang password baru",type:y?"text":"password",value:r.password_confirmation,onChange:s=>l("password_confirmation",s.target.value),disabled:i,className:"pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-gray-500",onClick:()=>H(!y),children:y?e.jsx(E,{size:18}):e.jsx(K,{size:18})})]})]})]})]})}),e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(u,{className:"flex h-full flex-col",children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center",children:[e.jsx(de,{size:20,className:"mr-2 text-emerald-600"}),"Foto Profil Pengguna"]})}),e.jsxs(g,{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-gray-300 p-8 text-center transition-colors hover:border-emerald-400",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",onChange:s=>W(s.target.files),className:"hidden",id:"file-upload",disabled:i}),e.jsxs("label",{htmlFor:"file-upload",className:`cursor-pointer ${i?"cursor-not-allowed opacity-50":""}`,children:[e.jsx(ce,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"mb-2 text-lg font-medium text-gray-700",children:"Klik untuk mengunggah atau seret file ke sini"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, JPEG hingga 2MB"})]})]}),h.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:h.map((s,a)=>e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:"flex aspect-square items-center justify-center rounded-lg bg-gray-100",children:s.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(s),alt:s.name,className:"h-full w-full rounded-lg object-cover"}):e.jsx(oe,{size:24,className:"text-gray-400"})}),e.jsx("button",{type:"button",onClick:()=>X(a),className:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity group-hover:opacity-100",disabled:i,children:e.jsx(ie,{size:14})}),e.jsx("p",{className:"mt-1 truncate text-xs text-gray-500",children:s.name})]},a))})]})]})})]}),e.jsxs("div",{className:"flex flex-col justify-start gap-4 rounded-lg border border-gray-200 bg-white p-3 shadow-sm sm:flex-row",children:[e.jsx(C,{type:"button",variant:"outline",onClick:m,className:"sm:w-auto",disabled:i,children:"Batal"}),e.jsx(C,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700 sm:w-auto",size:"lg",disabled:i,children:i?"Mengirim...":"Update"})]})]})]})},Fe=()=>{var i;const{props:o}=ee(),m=((i=o.auth)==null?void 0:i.user)??null,d=o.provinces??[];return m?e.jsx(te,{currentPage:"profile",children:e.jsx(me,{auth:{user:m},provinces:d,onBack:()=>J.visit("/profile")})}):null};export{Fe as default};
