import{r as y,j as e,S as _,J as F}from"./app-DqvPgPLX.js";import{B as R,C as z}from"./CitizenLayout-CZTR47zY.js";import{B as w,I as V}from"./input-_-d2rHVp.js";import{C as b,b as E,c as $,a as A}from"./card-f358nuNf.js";import{S as k,a as D,b as C,c as S,d as r}from"./select-QaOMUZcd.js";import{f as H}from"./formatDate-UvSedfNW.js";import{g as I,a as J}from"./missionStatusLabel-hBdcFGI7.js";import{S as Q,R as W}from"./sliders-horizontal-CY56mF2c.js";import{S as U}from"./search-BSytNz48.js";import{M as Z}from"./map-pin-BcgFq_I_.js";import{E as q}from"./eye-BmKQ7d-8.js";import{T as G}from"./Combination-bzKAMG6s.js";import"./index-28FC01iy.js";import"./createLucideIcon-9_-YZXNr.js";import"./index-DCNyB5w5.js";const K=({missions:c,myMissions:d,onViewDetails:N,provinces:o})=>{const[m,u]=y.useState("newest"),[i,M]=y.useState(""),[t,T]=y.useState({category:"semua",status:"semua",province:"semua",startDate:"",endDate:""}),L=y.useMemo(()=>{let s=c;if(i.trim()&&(s=s.filter(a=>{var l,n,p,j,g;return((l=a.title)==null?void 0:l.toLowerCase().includes(i.toLowerCase()))||((n=a.description)==null?void 0:n.toLowerCase().includes(i.toLowerCase()))||((j=(p=a.creator)==null?void 0:p.name)==null?void 0:j.toLowerCase().includes(i.toLowerCase()))||((g=a.address)==null?void 0:g.toLowerCase().includes(i.toLowerCase()))})),t.status!=="semua"){const l={open:"Dibuka","on-progress":"Sedang Berlangsung",completed:"Selesai",cancelled:"Dibatalkan","under-authority":"Misi Pihak Berwenang"}[t.status]||t.status;s=s.filter(n=>n.status===l)}return t.province!=="semua"&&(s=s.filter(a=>{var l;return((l=a.province)==null?void 0:l.name)===t.province})),t.startDate&&(s=s.filter(a=>{const l=new Date(a.scheduled_date),n=new Date(t.startDate);return l>=n})),t.endDate&&(s=s.filter(a=>{const l=new Date(a.scheduled_date),n=new Date(t.endDate);return l<=n})),[...s].sort((a,l)=>{switch(m){case"newest":return new Date(l.scheduled_date).getTime()-new Date(a.scheduled_date).getTime();case"oldest":return new Date(a.scheduled_date).getTime()-new Date(l.scheduled_date).getTime();case"title":return(a.title||"").localeCompare(l.title||"");case"status":return(a.status||"").localeCompare(l.status||"");default:return 0}})},[c,i,t,m]),f=(s,h)=>{T(a=>({...a,[s]:h}))},B=()=>{T({category:"semua",status:"semua",province:"semua",startDate:"",endDate:""}),M(""),u("newest")},x=i.trim()||t.status!=="semua"||t.province!=="semua"||t.startDate||t.endDate;return e.jsxs("div",{className:"px-4 py-8 mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx("div",{className:"flex flex-col items-start justify-between mb-8 md:flex-row md:items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"mb-2 text-3xl font-bold text-gray-900",children:d?"Misi yang Diikuti":"Daftar Misi"}),e.jsx("p",{className:"text-gray-600",children:"Temukan Misi dan jadilah bagian dalam aksi penyelamatan lingkungan"})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-4",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(b,{className:"sticky top-24",children:[e.jsx(E,{children:e.jsxs($,{className:"flex items-center justify-between text-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{size:20,className:"mr-2 text-sky-600"}),"Filter Misi"]}),x&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-emerald-100 text-emerald-600",children:"Aktif"})]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Status"}),e.jsxs(k,{value:t.status,onValueChange:s=>f("status",s),children:[e.jsx(D,{children:e.jsx(C,{placeholder:"Pilih status"})}),e.jsxs(S,{children:[e.jsx(r,{value:"semua",children:"Semua Status"}),e.jsx(r,{value:"open",children:"Dibuka"}),e.jsx(r,{value:"on-progress",children:"Sedang Berlangsung"}),e.jsx(r,{value:"completed",children:"Selesai"}),e.jsx(r,{value:"cancelled",children:"Dibatalkan"}),e.jsx(r,{value:"under-authority",children:"Misi Pihak Berwenang"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Provinsi"}),e.jsxs(k,{value:t.province,onValueChange:s=>f("province",s),children:[e.jsx(D,{children:e.jsx(C,{placeholder:"Pilih provinsi"})}),e.jsxs(S,{children:[e.jsx(r,{value:"semua",children:"Semua Provinsi"}),o==null?void 0:o.map(s=>e.jsx(r,{value:s.name,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Rentang Awal Tanggal"}),e.jsx("input",{type:"date",className:"w-full px-2 py-2 border border-gray-200 rounded-md",value:t.startDate,onChange:s=>f("startDate",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Rentang Akhir Tanggal"}),e.jsx("input",{type:"date",className:"w-full px-2 py-2 border border-gray-300 rounded",value:t.endDate,onChange:s=>f("endDate",s.target.value),min:t.startDate})]}),e.jsx("div",{className:"pt-4 space-y-2",children:e.jsxs(w,{variant:"outline",className:"flex items-center justify-center w-full gap-2",onClick:B,disabled:!x,children:[e.jsx(W,{className:"w-4 h-4"}),"Reset Filter"]})})]})]})}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 mb-6 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs(k,{value:m,onValueChange:u,children:[e.jsx(D,{className:"w-48",children:e.jsx(C,{placeholder:"Urutkan berdasarkan"})}),e.jsxs(S,{children:[e.jsx(r,{value:"newest",children:"Terbaru"}),e.jsx(r,{value:"oldest",children:"Terlama"}),e.jsx(r,{value:"title",children:"Judul A-Z"}),e.jsx(r,{value:"status",children:"Status"}),e.jsx(r,{value:"location",children:"Lokasi"})]})]})}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(U,{className:"absolute w-4 h-4 text-gray-400 left-3 top-3"}),e.jsx(V,{placeholder:"Cari misi...",className:"pl-10",value:i,onChange:s=>M(s.target.value)})]})]}),L.length>0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3",children:L.map(s=>{var h,a,l,n,p,j,g,P;return e.jsxs(b,{className:"transition-all duration-300 border-0 shadow-md cursor-pointer group hover:-translate-y-1 hover:shadow-lg",onClick:()=>{var v;return N((v=s.report)==null?void 0:v.id)},children:[e.jsxs("div",{className:"relative overflow-hidden rounded-t-lg",children:[(n=(l=(a=(h=s.report)==null?void 0:h.media)==null?void 0:a[0])==null?void 0:l.media_type)!=null&&n.startsWith("video")?e.jsxs("div",{className:"relative w-full h-48 bg-black",children:[e.jsx("video",{className:"object-cover w-full h-full opacity-50",src:`/storage/${s.report.media[0].media_url}`,muted:!0,preload:"metadata"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"p-2 rounded-full bg-white/80",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-black",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-5.197-3.03A1 1 0 008 9.03v5.94a1 1 0 001.555.832l5.197-3.03a1 1 0 000-1.664z"})})})})]}):e.jsx("img",{src:`/storage/${s.thumbnail_url}`,alt:s.title,className:"object-cover w-full h-48 transition-transform duration-300 group-hover:scale-105"}),e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(R,{className:J(s.status),children:I(s.status)})})]}),e.jsxs(A,{className:"p-4",children:[e.jsx("h3",{className:"mb-2 font-semibold text-gray-900 transition-colors line-clamp-2 group-hover:text-sky-600",children:s.title}),e.jsx("p",{className:"mb-3 text-sm text-gray-600 line-clamp-2",children:s.description}),e.jsx("div",{className:"flex items-center justify-between mb-3 text-xs text-gray-500",children:e.jsxs("span",{children:["Diverifikasi:"," ",(p=s.creator)==null?void 0:p.name]})}),e.jsxs("div",{className:"flex items-center mb-3 text-sm text-gray-500",children:[e.jsx(Z,{size:14,className:"mr-1"}),e.jsxs("span",{className:"truncate",children:[(j=s.district)==null?void 0:j.name,", ",(g=s.city)==null?void 0:g.name,","," ",(P=s.province)==null?void 0:P.name]})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"flex items-center text-sm text-gray-500",children:e.jsxs("span",{children:["Pelaksanaan:"," ",H(s.scheduled_date)]})})}),e.jsxs(w,{className:"w-full mt-auto transition-colors duration-200 bg-cyan-500 hover:bg-cyan-700",onClick:v=>{v.stopPropagation(),_.visit(`/report/${s.report.id}`)},children:[e.jsx(q,{size:16,className:"mr-2"}),"Lihat Detail"]})]})]},s.id)})})}):e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs(b,{className:"w-full px-8 py-32 text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"p-4 bg-gray-100 rounded-full",children:e.jsx(G,{size:32,className:"w-12 h-12 text-gray-400"})})}),e.jsx("h3",{className:"mb-2 text-lg font-semibold text-gray-900",children:x?"Tidak Ada Misi yang Sesuai":d?"Anda Belum Memiliki Misi":"Misi Belum Tersedia"}),e.jsx("p",{className:"text-sm text-gray-500",children:x?"Coba ubah filter atau kata kunci pencarian Anda.":d?"Anda belum memiliki misi. Silahkan mendaftar misi terlebih dahulu.":"Belum ada misi yang tersedia saat ini. Coba lagi nanti."}),x&&e.jsx(w,{variant:"outline",className:"mt-4",onClick:B,children:"Reset Filter"})]})})]})]})]})},ue=()=>{var u;const{props:c}=F(),d=((u=c.missions)==null?void 0:u.data)||[],N=c.myMissions,o=c.provinces.provinces??[],m=i=>{i?_.visit(route("report.show",{id:i})):alert("Laporan tidak tersedia untuk misi ini.")};return e.jsx(z,{currentPage:"mission",children:e.jsx(K,{myMissions:N,missions:d,onViewDetails:m,provinces:o})})};export{ue as default};
